version: "3"
services:
  openvpn-client:
    image: ghcr.io/wfg/openvpn-client
    cap_add:
      - NET_ADMIN
    environment:
      - KILL_SWITCH=on
      - SUBNETS=192.168.0.0/24,192.168.1.0/24
    devices:
      - /dev/net/tun
    volumes:
      - openvpn:/data/vpn
    networks:
      - vpn-network
    restart: unless-stopped

  qbittorrent:
    image: ghcr.io/linuxserver/qbittorrent
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=AMERICA/SAO_PAULO
      - WEBUI_PORT=8080
    volumes:
      - qbittorrent:/config
    networks:
      - vpn-network
      - caddy
    depends_on:
      - openvpn-client
    extra_hosts:
      - "openvpn-client:192.168.0.2"
    labels:
      caddy: qbittorrent.colman.com.br
      caddy.reverse_proxy: "{{upstreams 8080}}"

networks:
  vpn-network:
    driver: bridge
  caddy:
    external: true
