version: "3"
services:
  openvpn-client:
    image: ghcr.io/wfg/openvpn-client
    cap_add:
      - NET_ADMIN
    environment:
      - KILL_SWITCH=on
      - SUBNETS=192.168.0.0/24,192.168.1.0/24
    devices:
      - /dev/net/tun
    volumes:
      - openvpn:/data/vpn
    networks:
      - vpn-network

  deluge:
    image: linuxserver/deluge
    container_name: deluge
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
    volumes:
      - deluge-config:/config
      - deluge-downloads:/downloads
    network_mode: "service:openvpn-client"  # Use the VPN container's network

  deluge-web-proxy:
    image: linuxserver/deluge
    container_name: deluge-web-proxy
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
      - DELUGE_DAEMON_ADDR=deluge  # Connect to the daemon by name
      - DELUGE_DAEMON_PORT=58846   # Daemon port
    volumes:
      - deluge-config:/config 
    networks:
      - caddy
      - vpn-network
    labels:
      caddy: deluge.colman.com.br
      caddy.reverse_proxy: "{{upstreams 8112}}"

networks:
  vpn-network:
  caddy:
    external: true

volumes:
  openvpn:
  deluge-config:
  deluge-downloads:
