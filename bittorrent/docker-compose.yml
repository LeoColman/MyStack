version: "3"
services:
  openvpn-client:
    image: ghcr.io/wfg/openvpn-client
    cap_add:
      - NET_ADMIN
    environment:
      - KILL_SWITCH=on
      - SUBNETS=192.168.0.0/24,172.18.0.0/16
    devices:
      - /dev/net/tun
    volumes:
      - openvpn:/data/vpn
    networks:
      - vpn-network
      - caddy
    labels:
      caddy: transmission.colman.com.br
      caddy.reverse_proxy: "{{upstreams 9091}}"
  
  
  transmission:
    image: linuxserver/transmission
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
      - TRANSMISSION_WEB_UI=combustion  # Optional: Use a better UI for Transmission
      - USER=username  # Optional: Set a username for the Transmission web UI
      - PASS=password  # Optional: Set a password for the Transmission web UI
    volumes:
      - deluge-config:/config
      - deluge-downloads:/downloads
    network_mode: "service:openvpn-client"  # Use VPN for Transmission     
      
#  deluge:
#    image: linuxserver/deluge
#    environment:
#      - PUID=1000
#      - PGID=1000
#      - TZ=Etc/UTC
#    volumes:
#      - deluge-config:/config
#      - deluge-downloads:/downloads
#    network_mode: "service:openvpn-client"  # Use the VPN container's network
  
#  qbittorrent:
#    image: ghcr.io/linuxserver/qbittorrent
#    environment:
#      - PUID=1000
#      - PGID=1000
#      - TZ=America/Sao_Paulo
#      - WEBUI_PORT=6011
#    volumes:
#      - deluge-config:/config
#      - deluge-downloads:/downloads
#    network_mode: "service:openvpn-client"   
    
  opentracker:
    image: lednerb/opentracker-docker
    environment:
      - PUID=1000
      - PGID=1000
    ports:
      - "6969:6969/udp"   
      - "6969:6969/tcp"   
    networks:
      - vpn-network
      - caddy
    labels:
      caddy: tracker.colman.com.br
  
networks:
  vpn-network:
    driver: bridge
  caddy:
    external: true

volumes:
  openvpn:
  deluge-config:
  deluge-downloads:
  qbittorrent-downloads:
  qbittorrent-config:
