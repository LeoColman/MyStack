# Telegraf Configuration File (Expanded)
[agent]
  interval = "30s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  flush_interval = "10s"
  flush_jitter = "0s"
  hostname = "DietPi-NAS"

###############################################################################
# OUTPUT PLUGIN: InfluxDB
###############################################################################
[[outputs.influxdb]]
  urls = ["http://influxdb:8086"]
  database = "telegraf"
  username = "admin"
  password = "admin"
  timeout = "5s"

###############################################################################
# INPUT PLUGIN: SNMP (Expanded)
###############################################################################
[[inputs.snmp]]
  agents = ["udp://192.168.15.165:161"]  # Replace with your NAS IP
  version = 2
  community = "public"
  interval = "30s"

  ## System Uptime
  [[inputs.snmp.field]]
    name = "system_uptime"
    oid = "1.3.6.1.2.1.1.3.0"
    conversion = "int"

  ## CPU Load (1 min, 5 min, 15 min)
  [[inputs.snmp.field]]
    name = "cpu_load_1min"
    oid = "1.3.6.1.4.1.2021.10.1.3.1"
    conversion = "float"

  [[inputs.snmp.field]]
    name = "cpu_load_5min"
    oid = "1.3.6.1.4.1.2021.10.1.3.2"
    conversion = "float"

  [[inputs.snmp.field]]
    name = "cpu_load_15min"
    oid = "1.3.6.1.4.1.2021.10.1.3.3"
    conversion = "float"

  ## Memory Usage (Total, Used, Available)
  [[inputs.snmp.field]]
    name = "mem_total"
    oid = "1.3.6.1.4.1.2021.4.5.0"
    conversion = "int"

  [[inputs.snmp.field]]
    name = "mem_available"
    oid = "1.3.6.1.4.1.2021.4.6.0"
    conversion = "int"

  [[inputs.snmp.field]]
    name = "mem_used"
    oid = "1.3.6.1.4.1.2021.4.11.0"
    conversion = "int"

  ## Disk Usage (Total, Used, Free)
  [[inputs.snmp.table]]
    name = "disk_usage"
    oid = "1.3.6.1.4.1.2021.9.9"
    oid_index_as_tag = true  # Ensure proper indexing

    [[inputs.snmp.field]]
      name = "disk_path"
      oid = "1.3.6.1.4.1.2021.9.2.1.2"
      is_tag = true

    [[inputs.snmp.field]]
      name = "disk_total"
      oid = "1.3.6.1.4.1.2021.9.2.1.6"
      conversion = "int"

    [[inputs.snmp.field]]
      name = "disk_used"
      oid = "1.3.6.1.4.1.2021.9.2.1.8"
      conversion = "int"

    [[inputs.snmp.field]]
      name = "disk_free"
      oid = "1.3.6.1.4.1.2021.9.2.1.7"
      conversion = "int"

  ## Network Traffic (Bytes In/Out per Interface)
  [[inputs.snmp.table]]
    name = "network_traffic"
    oid = "1.3.6.1.2.1.2.2.1"
    oid_index_as_tag = true  # Use the interface index

    [[inputs.snmp.field]]
      name = "interface"
      oid = "1.3.6.1.2.1.2.2.1.2"
      is_tag = true

    [[inputs.snmp.field]]
      name = "bytes_in"
      oid = "1.3.6.1.2.1.2.2.1.10"
      conversion = "int"

    [[inputs.snmp.field]]
      name = "bytes_out"
      oid = "1.3.6.1.2.1.2.2.1.16"
      conversion = "int"
