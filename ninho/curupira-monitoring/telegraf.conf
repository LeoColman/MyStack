# Global Agent Configuration
[agent]
  interval = "30s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = ""
  hostname = "DietPi-NAS"
  omit_hostname = false

###############################################################################
# OUTPUT PLUGIN: InfluxDB
###############################################################################
[[outputs.influxdb]]
  urls = ["http://influxdb:8086"]
  database = "snmp"
  username = "admin"
  password = "admin"
  timeout = "5s"
  retention_policy = "autogen"

###############################################################################
# INPUT PLUGIN: SNMP (Using Raw OIDs)
###############################################################################
[[inputs.snmp]]
  agents = ["udp://192.168.15.165:161"]  # Replace with your NAS IP
  version = 2
  community = "public"
  interval = "30s"

  ## System Information
  [[inputs.snmp.field]]
    name = "system_uptime"
    oid = "1.3.6.1.2.1.1.3.0"  # sysUpTime
    conversion = "int"

  [[inputs.snmp.field]]
    name = "hostname"
    oid = "1.3.6.1.2.1.1.5.0"  # sysName
    is_tag = true

  [[inputs.snmp.field]]
    name = "system_description"
    oid = "1.3.6.1.2.1.1.1.0"  # sysDescr

  ## CPU Load
  [[inputs.snmp.field]]
    name = "cpu_load_1min"
    oid = "1.3.6.1.4.1.2021.10.1.3.1"
    conversion = "float"

  [[inputs.snmp.field]]
    name = "cpu_load_5min"
    oid = "1.3.6.1.4.1.2021.10.1.3.2"
    conversion = "float"

  [[inputs.snmp.field]]
    name = "cpu_load_15min"
    oid = "1.3.6.1.4.1.2021.10.1.3.3"
    conversion = "float"

  ## Memory Usage
  [[inputs.snmp.field]]
    name = "mem_total"
    oid = "1.3.6.1.4.1.2021.4.5.0"  # Total RAM
    conversion = "int"

  [[inputs.snmp.field]]
    name = "mem_available"
    oid = "1.3.6.1.4.1.2021.4.6.0"  # Available RAM
    conversion = "int"

  [[inputs.snmp.field]]
    name = "mem_used"
    oid = "1.3.6.1.4.1.2021.4.11.0"  # Used RAM
    conversion = "int"

  ## Disk Usage (per mounted storage)
  [[inputs.snmp.table]]
    name = "disk_usage"
    oid = "1.3.6.1.4.1.2021.9.9"

    [[inputs.snmp.field]]
      name = "disk_path"
      oid = "1.3.6.1.4.1.2021.9.2.1.2"  # Mounted Path
      is_tag = true

    [[inputs.snmp.field]]
      name = "disk_total"
      oid = "1.3.6.1.4.1.2021.9.2.1.6"  # Total Storage
      conversion = "int"

    [[inputs.snmp.field]]
      name = "disk_used"
      oid = "1.3.6.1.4.1.2021.9.2.1.8"  # Used Storage
      conversion = "int"

  ## Network Traffic
  [[inputs.snmp.table]]
    name = "network_traffic"
    oid = "1.3.6.1.2.1.2.2.1"

    [[inputs.snmp.field]]
      name = "interface"
      oid = "1.3.6.1.2.1.2.2.1.2"  # Interface Name
      is_tag = true

    [[inputs.snmp.field]]
      name = "bytes_in"
      oid = "1.3.6.1.2.1.2.2.1.10"  # Incoming Bytes
      conversion = "int"

    [[inputs.snmp.field]]
      name = "bytes_out"
      oid = "1.3.6.1.2.1.2.2.1.16"  # Outgoing Bytes
      conversion = "int"

  ## System Load
  [[inputs.snmp.field]]
    name = "system_processes"
    oid = "1.3.6.1.2.1.25.1.6.0"  # Number of processes
    conversion = "int"

  [[inputs.snmp.field]]
    name = "users_logged_in"
    oid = "1.3.6.1.2.1.25.1.5.0"  # Number of logged-in users
    conversion = "int"

###############################################################################
# LOGGING & DEBUGGING
###############################################################################
[log]
  logfile = "/var/log/telegraf.log"
  level = "info"
